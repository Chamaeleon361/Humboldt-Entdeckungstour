const  
raeumeDatenbank = {

// Keller
r007: {
  bild: 'assets/bilder/keller/007.jpg',
  rotation: "0 130 0",
},

r011: {
  bild: 'assets/bilder/keller/011.jpg',
  rotation: "0 20 0",
  
},

r008: {
  bild: 'assets/bilder/keller/008.jpg',
  rotation: "0 -33 0",
  
},

r009: {
  bild: 'assets/bilder/keller/009_1.jpg',
  rotation: "0 135 0",
 
},

r010: {
  bild: 'assets/bilder/keller/010.jpg',
  rotation: "0 155 0",
},

r005: {
  bild: 'assets/bilder/keller/005.jpg',
  rotation: "0 -1 0",
  
},

r004: {
  bild: 'assets/bilder/keller/004.jpg',
  rotation: "0 -56 0",
 
},

r001: {
  bild: 'assets/bilder/keller/001.jpg',
  rotation: "0 -146 0",
 
},

r021: {
  bild: 'assets/bilder/keller/021.jpg',
  rotation: "0 -65 0",
 
},

//1.Etage

r105: {
  bild: 'assets/bilder/1etage/105.jpg',
  rotation: "0 160 0",
    
},

r106: {
  bild: 'assets/bilder/1etage/106.jpg',
  rotation: "0 -120 0",
 
},

r108: {
  bild: 'assets/bilder/1etage/108h.jpg',
  rotation: "0 192 0",
 
},

r109: {
  bild: 'assets/bilder/1etage/109.jpg',
  rotation: "0 22 0",
 
},

r104: {
  bild: 'assets/bilder/1etage/104.jpg',
  rotation: "0 -71 0",
  
},

r103: {
  bild: 'assets/bilder/1etage/103.jpg',
  rotation: "0 -9 0",
 
},

r102: {
  bild: 'assets/bilder/1etage/102.jpg',
  rotation: "0 97 0",
  
},

r101: {
  bild: 'assets/bilder/1etage/101.jpg',
  rotation: "0 60 0",
  
},

r117: {
  bild: 'assets/bilder/1etage/117.jpg',
  rotation: "0 88 0",
  
},


//2.Etage

r207: {
  bild: 'assets/bilder/2etage/207.jpg',
  rotation: "0 65 0",
  
},

r208: {
  bild: 'assets/bilder/2etage/208.jpg',
  rotation: "0 -120 0",
  
},

r210: {
  bild: 'assets/bilder/2etage/210.jpg',
  rotation: "0 38 0",
},


r204: {
  bild: 'assets/bilder/2etage/204.jpg',
  rotation: "0 -36 0",
  
},

r212: {
  bild: 'assets/bilder/2etage/212.jpg',
  rotation: "0 -35 0",
 
},

r213: {
  bild: 'assets/bilder/2etage/213.jpg',
  rotation: "0 -118 0",
 
},

r215: {
  bild: 'assets/bilder/2etage/lehrerzimmer_normal.jpeg',
  rotation: "0 0 0",
  
},

r203: {
  bild: 'assets/bilder/2etage/203.jpg',
  rotation: "0 -90 0",
  
},

r202: {
  bild: 'assets/bilder/2etage/202.jpg',
  rotation: "0 173 0",
},


r201: {
  bild: 'assets/bilder/2etage/201.jpg',
  rotation: "0 -128 0",
  
},

r220: {
  bild: 'assets/bilder/2etage/220.jpg',
  rotation: "0 -15 0",
  
},

r221: {
  bild: 'assets/bilder/2etage/221.jpg',
  rotation: "0 -162 0",
  
},

//3.Etage


Aula: {
  bild: 'assets/bilder/3etage/Aula_1.jpg',
  rotation: "0 88 0",
  
},

r308: {
  bild: 'assets/bilder/3etage/308.jpg',
  rotation: "0 66 0",
}, 

r306: {
  bild: 'assets/bilder/3etage/306.jpg',
  rotation: "0 119 0",

},

r304: {
  bild: 'assets/bilder/3etage/304.jpg',
  rotation: "0 83 0",
 
},

r310: {
  bild: 'assets/bilder/3etage/310.jpg',
  rotation: "0 27 0",
  
},

r303: {
  bild: 'assets/bilder/3etage/303.jpg',
  rotation: "0 -130 0",
  
},

r309: {
  bild: 'assets/bilder/3etage/309.jpg',
  rotation: "0 -170 0",
  
},

r301: {
  bild: 'assets/bilder/3etage/301_1.jpg',
  rotation: "0 -106 0",
  
},

r301: {
  bild: 'assets/bilder/3etage/301_2.jpg',
  rotation: "0 -80 0",
  
},

r315: {
  bild: 'assets/bilder/3etage/315_1.jpg',
  rotation: "0 -21 0",
  
},
r315: {
    bild: 'assets/bilder/3etage/315_2.jpg',
    rotation: "0 -21 0",
    
  },


//Neubau

r12: {
  bild: 'assets/bilder/neubau/1.2.jpg',
  rotation: "0 -122 0",
  
},

r13: {
  bild: 'assets/bilder/neubau/1.3.jpg',
  rotation: "0 -5 0",
  
},

r14: {
  bild: 'assets/bilder/neubau/1.4.jpg',
  rotation: "0 135 0",
  
},

r21: {
  bild: 'assets/bilder/neubau/2.1.1.jpg',
  rotation: "0 94 0",
 
},

r21: {
  bild: 'assets/bilder/neubau/2.1.2.jpg',
  rotation: "0 33 0",
},

r22: {
  bild: 'assets/bilder/neubau/2.2.jpg',
  rotation: "0 158 0",
  
},

r23: {
  bild: 'assets/bilder/neubau/2.3.jpg',
  rotation: "0 90 0",
  
},

r24: {
  bild: 'assets/bilder/neubau/2.4.jpg',
  rotation: "0 -88 0",
  
},

r25: {
  bild: 'assets/bilder/neubau/2.5.jpg',
  rotation: "0 -128 0",
  
}

}

let spielModusAktiv = false;
let spielGestartet = false;
let aktuellerRaum = "";
let fehlerCount = 0;
let errateneRaeume = new Set();

const raeumeKeys = Object.keys(raeumeDatenbank)

//beim Laden der Seite ausblenden
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("spiel-container").style.display = "none";
});

function toggleSpielmodus() {
  
  spielModusAktiv = !spielModusAktiv;
  document.getElementById("spiel-container").style.display = spielModusAktiv ? "block" : "none";
  

if (!spielModusAktiv) {
    verlasseSpielmodus();
  }
  else {
    document.getElementById("eingabe").value = "";
    document.getElementById("eingabe").disabled = true;
    document.getElementById("auswertung").innerText = "";
    document.getElementById("absendenBtn").disabled = true;
    fehlerCount = 0; 

}
}


function waehleRaum() {
  // Alle RÃ¤ume, die noch nicht erraten wurden
  let raeumeZumWaehlen = raeumeKeys.filter(key => !errateneRaeume.has(key));

  // Wenn alle RÃ¤ume erraten wurden, starte von vorne (oder gehe in den Reset-Status)
  if (raeumeZumWaehlen.length === 0) {
      errateneRaeume.clear();  
      raeumeZumWaehlen = raeumeKeys;
  }

  // Einen zufÃ¤lligen Raum aus den noch verfÃ¼gbaren auswÃ¤hlen
  const zufaelligerRaum = raeumeZumWaehlen[Math.floor(Math.random() * raeumeZumWaehlen.length)];
  return zufaelligerRaum;
}

function raumErraten(raum) {
  errateneRaeume.add(raum);
}




function starteSpiel() {

  aktuellerRaum = waehleRaum();
  document.getElementById("eingabe").value = "";
  document.getElementById("eingabe").disabled = false;
  document.getElementById("auswertung").innerText = "";
  document.getElementById("vorschlaege").innerHTML = "";  
  document.getElementById("absendenBtn").disabled = false;

  fehlerCount = 0;
  spielGestartet = true;
  
  entferneElemente();
  ladeSpielRaum(aktuellerRaum);
}

// LÃ¤dt den Raum im Spielmodus in die a-sky (ohne Pfeile)
function ladeSpielRaum(raum) {
  const raumDaten = raeumeDatenbank[raum];
  if (!raumDaten) return;
  const sky = document.getElementById("sky");
  sky.setAttribute("src", raumDaten.bild);
  sky.setAttribute("rotation", raumDaten.rotation);
  
}

function entferneElemente() {
    document.querySelectorAll(".pfeil").forEach(p => {p.setAttribute("visible",false)});
    document.querySelector("#punktKlein").setAttribute("visible",false);
    document.querySelector("#Grundriss").setAttribute("visible",false);
    document.querySelector("#raum-text").setAttribute("visible",true);
}
  
function pruefeAntwort() {
  let eingabe = document.getElementById("eingabe").value.toLowerCase().trim();

  if (!eingabe.startsWith("r")) {
      eingabe = "r" + eingabe;
  }

  if (eingabe === aktuellerRaum) {
    document.getElementById("auswertung").innerText = "Richtig! ðŸŽ‰";    
    document.getElementById("absendenBtn").disabled = true;
    document.getElementById("eingabe").disabled = true;  
    spielGestartet = false;
    raumErraten(aktuellerRaum);

  } else {
    fehlerCount++;
    if (fehlerCount < 3) {
      document.getElementById("auswertung").innerText = "Falsch!";
    } else {
      document.getElementById("auswertung").innerText = `Falsch! Die richtige Antwort ist: ${aktuellerRaum}`;
      spielGestartet = false;
      document.getElementById("eingabe").disabled = true; 
      document.getElementById("absendenBtn").disabled = true;
    }
  }
  document.getElementById("eingabe").value = "";
  document.getElementById("vorschlaege").innerHTML = "";
}

//Enter-Taste
document.getElementById("eingabe").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
        pruefeAntwort();
    }
});


function filterVorschlaege() {
  let input = document.getElementById("eingabe").value.toLowerCase().trim();
  if (!input.startsWith("r")) {
      input = "r" + input;
  }
  const vorschlaege = raeumeKeys.filter(r => r.includes(input)).slice(0, 5);
  document.getElementById("vorschlaege").innerHTML = vorschlaege.map(r => {
    let nummerOhneR = r.replace(/^r/, "");
    return `<div onclick='setzeEingabe("${r}")'>${nummerOhneR}</div>`;//noch Ã¤ndern sodass r nicht mit gesetzt wird
}).join("");
}

function setzeEingabe(raum) {
  document.getElementById("eingabe").value = raum;
  document.getElementById("vorschlaege").innerHTML = "";
}

function verlasseSpielmodus() {
    document.querySelectorAll(".pfeil").forEach(p => {p.setAttribute("visible",true)});
    
    document.querySelector("#punktKlein").setAttribute("visible",true);
    document.querySelector("#Grundriss").setAttribute("visible",true);
    document.querySelector("#raum-text").setAttribute("visible",true);

    document.getElementById("vorschlaege").innerHTML = "";
    document.getElementById("auswertung").innerHTML = "";
    document.getElementById("eingabe").value = "";
ladeRaum('haupteingang')
    
};